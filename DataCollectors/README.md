# Data collectors for OMV push notifications

Author: Axel Y. Rivera </br>
e-mail: axelrivera1986@gmail.com </br>

## Summary:

Data collectors are just regular python functions that will generate the notification messages. These functions will return a python list with the following elements:

```
[bool, str, str]
```

The elements represent the following:
- Element 0: a bool that says if the message is valid or not (`True|False`)
- Element 1: a string that represents the message's title
- Element 2: a string that represents the message's body

For example, the data collector `temperature_collector` with the arguments `70` and `False` will generate the following list if the temperature of the CPU is 70 C° or higher:

```
[True, "Critical temperature found in OMV system", "CPU reached 70.0 C°"]
```

Then, a footer will be created and the final message will look as follows:

```
Critical temperature found in OMV system
CPU reached 70.0C°

OMV Web link: protocol//hostname.domain:port
Date: MM/DD/YYYY
Time: HH:MM:SS [AM|PM]
```

If the list returns the `[False, "", ""]`, then it means that the message is not valid and won't be sent.

## Current collectors available
### CPU temperature
- Short description: Check if the CPU temperature reaches a critical temperature
- File name: [TemperatureCollector.py](/DataCollectors/TemperatureCollector.py)
- Registry function: `message_handler.add_collector(DataCollectors.temperature_collector, critical_temp, debug)`
- Parameters:
    - critical_temp: Critical temperature that where the message will be sent (float number)
    - debug: Print message in debug mode (boolean)

### Updates available:
- Short description: Check if there are updates available
- File name: [UpdatesAvailableCollector.py](/DataCollectors/UpdatesAvailableCollector.py)
- Registry function: `message_handler.add_collector(DataCollectors.updates_available_collector, dir_path, debug)`
- Parameters:
    - dir_path: Path of the directory used to store temporary data (string)
    - debug: Print message in debug mode (boolean)

### Disk space:
- Short description: Check if an specific mount path that represents an HDD has less than x% of space free
- File name: [DiskSpaceCollector.py](/DataCollectors/DiskSpaceCollector.py)
- Registry function: `message_handler.add_collector(DataCollectors.disk_space_collector, mount_path, disk_name, dir_path, critical_precent_free, days_interval, debug)`
- Parameters:
    - mount_path: Path for the mount that you want to keep track (string)
    - disk_name: Name that you would like to set for the mount (string)
    - dir_path: Path of directory used to store temporary data (string)
    - critical_percent_free: Percentage of free space available to send the message (float)
    - days_interval: Interval of days to resend the message if space still not available (integer)
    - debug: Print debug message (boolean)

## How to create your own data collector?

To implement a new data collector function, just create a new python file with a function in the DataCollectors directory. The function needs to return a list with the form mentioned in the [Summary](#summary) section. Take a look at the function `temperature_collector` in [TemperatureCollector.py](/DataCollectors/TemperatureCollector.py) for a simple example. This is a module with a function that collects the CPU temperature, and if it is equal or higher than the critical parameter then generate the message. Once the data collector function is implemented, it needs to be registered in [../DataCollectorsRegistry.py](/DataCollectorsRegistry.py). This module contains one function that is used for registering all the collectors in the messages handler. Update the function by adding the following line at the end of the file (don't forget the 4 spaces indentation):

```
    message_handler.add_collector(DataCollectors.new_function_name, param 1, ..., param N)
```
The data collectors register passes the `args` collected from the command line in case you need to use debug, emulation, or anything from it. Also, importing the directory DataCollectors will automatically add your new module, therefore there is nothing else to do aside adding your new file with the collector function and registering the function. Test your new collector with the following command:

```
python3 /PATH/TO/OMVPushNotifications.py -d
```

This will print the messages generated by the collectors registered in the command line. Try without `-d` or with `-e` to send the actual message. Also, remember to update the [Current collectors available](#current-collectors-available) section in this README file with the information related to the new collector. Try keeping the same format:

### Collector Name
- Short description: One or two sentences describing what it does
- File name: FILE_NAME.py
- Registry function: `message_handler.add_collector(DataCollectors.function_name, parameter 1, parameter 2, ..., parameter n)`
- Parameters:
    - parameter 1: Description (type)
    - parameter 2: Description (type)
    - &#8942;
    - parameter n: Description (type)
